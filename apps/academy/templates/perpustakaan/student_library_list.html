{% extends layout_path %}
{% load static %}

{% block title %}Perpustakaan Digital{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-label-primary text-center py-5 shadow-none border-0">
            <div class="card-body">
                <h3 class="text-primary fw-bold mb-2">Perpustakaan Digital</h3>
                <p class="mb-4 text-muted">Jelajahi koleksi buku, modul, dan referensi lainnya.</p>
                
                <form method="get" class="mx-auto position-relative" style="max-width: 600px;">
                    <div class="input-group input-group-lg input-group-merge bg-white rounded-pill shadow-sm">
                        <span class="input-group-text border-0 ps-4 bg-transparent"><i class="ri-search-line"></i></span>
                        <input type="text" name="q" class="form-control border-0 bg-transparent" 
                               placeholder="Cari judul buku, penulis..." value="{{ search_query }}">
                        <button class="btn btn-primary rounded-pill px-4 m-1" type="submit">Cari</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="d-flex overflow-auto gap-2 mb-4 pb-2 align-items-center">
    <span class="text-muted small fw-bold me-2 text-uppercase">Kategori:</span>
    <a href="{% url 'student-library-list' %}" 
       class="btn btn-sm rounded-pill {% if not active_category %}btn-dark{% else %}btn-outline-secondary{% endif %} text-nowrap">
       Semua
    </a>
    {% for cat in categories %}
    <a href="?category={{ cat.name }}" 
       class="btn btn-sm rounded-pill {% if active_category == cat.name %}btn-dark{% else %}btn-outline-secondary{% endif %} text-nowrap">
        {{ cat.name }}
    </a>
    {% endfor %}
</div>

<div class="row g-4">
    {% for book in books %}
    <div class="col-sm-6 col-md-4 col-lg-3 col-xl-2">
        <div class="card h-100 border-0 shadow-sm hover-card product-card">
            <div class="position-relative">
                <a href="{% url 'student-book-read' book.id %}">
                    {% if book.cover %}
                        <img src="{{ book.cover.url }}" class="card-img-top object-fit-cover rounded-top" alt="{{ book.title }}" style="height: 220px;">
                    {% else %}
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center text-muted rounded-top" style="height: 220px;">
                            <div class="text-center">
                                <i class="ri-book-line ri-2x mb-1"></i>
                                <small class="d-block">No Cover</small>
                            </div>
                        </div>
                    {% endif %}
                </a>
                <span class="badge bg-white text-dark position-absolute top-0 end-0 m-2 shadow-sm opacity-75">
                    {{ book.category.name|default:"Umum" }}
                </span>
            </div>
            
            <div class="card-body p-3 d-flex flex-column">
                <h6 class="card-title mb-1 small fw-bold text-truncate" title="{{ book.title }}">
                    <a href="{% url 'student-book-read' book.id %}" class="text-heading stretched-link">{{ book.title }}</a>
                </h6>
                <small class="text-muted mb-2 text-truncate">{{ book.author|default:"Anonim" }}</small>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12 text-center py-5">
        <div class="avatar avatar-xl mx-auto mb-3">
            <span class="avatar-initial rounded-circle bg-label-secondary"><i class="ri-search-2-line ri-40px"></i></span>
        </div>
        <h5 class="mb-1">Tidak ada buku ditemukan</h5>
        <p class="text-muted">Coba kata kunci lain atau reset filter kategori.</p>
        <a href="{% url 'student-library-list' %}" class="btn btn-outline-primary btn-sm mt-2">Lihat Semua Buku</a>
    </div>
    {% endfor %}
</div>

<style>
.hover-card { transition: transform 0.2s, box-shadow 0.2s; }
.hover-card:hover { transform: translateY(-5px); box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important; }
</style>
{% endblock %}